<nav>
  <div class="logo">
    <a routerLink="/home" style="color: #000080;">HOM.MEALS</a>
    <p>Nourish your body, simplify your life.</p>
  </div>
  <ul>
    <li><a routerLink="/home" routerLinkActive="active-link" [routerLinkActiveOptions]="{ exact: true }">Home</a></li>
    <li><a routerLink="/about" routerLinkActive="active-link">About</a></li>
    <li><a routerLink="/shop-meal-plans" routerLinkActive="active-link">Shop Meal Plans</a></li>
    <li><a routerLink="/recipes" routerLinkActive="active-link">Recipes</a></li>
    <li><a routerLink="/contact" routerLinkActive="active-link">Contact</a></li>
  </ul>
  <div class="nav-icons">
    <div class="notification-icon" (click)="openNotifications()">
      <i class="fa-regular fa-bell"></i>
    </div>
    <div class="user-dropdown">
      <div class="user-circle" (click)="toggleUserDropdown()">{{ userInitial }}</div>
      <div class="dropdown-arrow" (click)="toggleUserDropdown()">â–¼</div>
      <div class="dropdown-menu" *ngIf="showUserDropdown">
        <span>Profile</span>
        <span (click)="toggleOrders()">Orders</span>
        <span>Logout</span>
      </div>
    </div>
    <div class="cart-icon" (click)="toggleCart()">
      <i class="fa-solid fa-cart-shopping"></i>
      <div class="badge" *ngIf="cartItemsCount > 0">{{ cartItemsCount }}</div>
    </div>
  </div>
</nav>
<div class="overlay" [class.active]="isCartOpen" (click)="toggleCart()"></div>
<div class="cart-sidebar" [class.open]="isCartOpen">
  <div class="cart-content">
    <h2 class="header-with-close">Shopping cart <i class="fa-solid fa-xmark" (click)="toggleCart()"></i></h2>
    <p-table [value]="selectedFoods"
             styleClass="p-datatable-striped">
      <ng-template pTemplate="body" let-item>
        <tr>
          <td><img height="100px" width="150px" [src]="item.image" alt="{{ item.name }}" class="shadow-4"></td>
          <td>{{ item.name }}</td>
          <td>{{ item.category }}</td>
          <td>{{ item.calories }}</td>
          <td>${{ item.price }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="summary">
        <div class="flex align-items-center justify-content-end">
          Total Price: ${{ totalPrice }}
        </div>
      </ng-template>
    </p-table>
    <div class="payment-methods">
      <p>Payment Methods:</p>
      <div class="flex flex-wrap gap-3">
        <div *ngFor="let method of paymentMethods" class="field-checkbox">
          <p-radioButton
            [inputId]="method"
            name="payment-method"
            [(ngModel)]="selectedPaymentMethod"
            [value]="method" />
          <label [for]="method" class="ml-2">
            {{ method }}
          </label>
        </div>
      </div>
    </div>
    <p-button [disabled]="!selectedPaymentMethod || selectedFoods.length == 0" label="Pay" (click)="pay()" [rounded]="true" />
  </div>
</div>
<app-modal *ngIf="showOrderModal">
  <p>You purchased the order successfully. Please check the progress in <a (click)="toggleOrders()">Orders</a>.</p>
</app-modal>
<app-modal *ngIf="showOrdersModal">
  <h2 class="header-with-close">Orders <i class="fa-solid fa-xmark" (click)="toggleOrders()"></i></h2>
  <p-table [value]="orders" [tableStyle]="{ 'min-width': '50rem' }">
    <ng-template pTemplate="header">
      <tr>
        <th>No</th>
        <th>Total price</th>
        <th>Status</th>
        <th>Action</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-order let-rowIndex="rowIndex">
      <tr>
        <td>{{ rowIndex + 1 }}</td>
        <td>${{ order.totalPrice }}</td>
        <td>{{ order.status }}</td>
        <td>
          <button (click)="toggleOrderDetails(order)">Order Details</button>
          <app-modal *ngIf="order.showDetails">
            <h4 class="header-with-close">Order Details: <i class="fa-solid fa-xmark" (click)="toggleOrderDetails(order)"></i></h4>

            <p-table [value]="order.items" [tableStyle]="{ 'min-width': '50rem' }">
              <ng-template pTemplate="header">
                <tr>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Category</th>
                  <th>Calories</th>
                  <th>Price</th>
                </tr>
              </ng-template>
              <ng-template pTemplate="body" let-item>
                <tr>
                  <td><img height="100px" width="150px" [src]="item.image" alt="{{ item.name }}"></td>
                  <td>{{ item.name }}</td>
                  <td>{{ item.category }}</td>
                  <td>{{ item.calories }}</td>
                  <td>${{ item.price }}</td>
                </tr>
              </ng-template>
            </p-table>
          </app-modal>
        </td>
      </tr>
    </ng-template>
  </p-table>
</app-modal>
